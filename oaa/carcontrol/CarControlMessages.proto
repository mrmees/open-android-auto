// Android Auto Protocol Buffer Definitions
// https://github.com/mrmees/open-android-auto
// SPDX-License-Identifier: GPL-3.0-or-later

/*
 * Car Control channel messages (GAL channel type 19, CAR_CONTROL)
 * Handler: hxp.java, log tag: CAR.GAL.CAR_CONTROL
 *
 * This channel provides VHAL (Vehicle HAL) property access — HVAC controls,
 * seat temperature, defrost, toll card status, etc. The HU registers listeners
 * for car properties and receives change events. It can also set property values.
 *
 * Message IDs (from vee.Y/vee.Z):
 *   0x8001 = CAR_CONTROL_SET_CAR_PROPERTY_VALUE_REQUEST    (HU→Phone)
 *   0x8002 = CAR_CONTROL_SET_CAR_PROPERTY_VALUE_RESPONSE   (Phone→HU, wcb)
 *   0x8003 = CAR_CONTROL_REGISTER_CAR_PROPERTY_LISTENERS_REQUEST (HU→Phone)
 *   0x8004 = CAR_CONTROL_REGISTER_CAR_PROPERTY_LISTENERS_RESPONSE (Phone→HU, wbk)
 *   0x8005 = CAR_CONTROL_CAR_PROPERTY_CHANGE_EVENT         (Phone→HU, vwu)
 *   0x8006 = CAR_CONTROL_CAR_ACTION_NOTIFICATION           (logged as unexpected)
 *   0x8007 = CAR_CONTROL_CAR_CONTROL_GROUP_UPDATE           (Phone→HU, vwn)
 *
 * Proto3 sub-messages (CarProperty, CarAreaId, CarAction, CarPropertyValue,
 * CarPropertyControl, IntValues, FloatValues, LongValues) are in
 * CarPropertyData.proto — split because the APK compiles those as proto3.
 *
 * APK: AA v16.1
 */

syntax = "proto2";

import "oaa/carcontrol/CarPropertyData.proto";

package oaa.proto.messages;

// ============================================================================
// Enums (proto2)
// ============================================================================

// Status codes for property operations (APK enum: vyw)
enum CarControlStatus {
    CAR_CONTROL_STATUS_SUCCESS = 0;
    CAR_CONTROL_STATUS_CAR_PROPERTY_SET_REQUEST_FAILED = 1;       // APK: -26
    CAR_CONTROL_STATUS_CAR_PROPERTY_LISTENER_REGISTRATION_FAILED = 2; // APK: -27
}

// Side affinity for controls — driver vs passenger side
// (APK class: vwl, field 6; SafeParcelable: CarControl.sideAffinity)
enum SideAffinity {
    SIDE_NONE = 0;
    SIDE_DRIVER = 1;
    SIDE_PASSENGER = 2;
}

// Control group type (APK class: vwm, field 1)
enum CarControlGroupType {
    CAR_CONTROL_GROUP_UNKNOWN = 0;
    CAR_CONTROL_GROUP_PRIMARY = 1;
}

// Metadata type for CarControl entries (APK enum: vuu)
enum CarControlMetadataType {
    METADATA_UNKNOWN = 0;
    METADATA_COMPACT_UI = 1;
}

// ============================================================================
// Sub-messages (proto2)
// ============================================================================

// APK class: vwi → wraps CarAction for action-only controls
message CarActionControl {
    optional CarAction action = 1;
}

// APK class: vwl → SafeParcelable: CarControl
// A single control entry — either a property, action, or nested group.
message CarControl {
    oneof control {
        CarPropertyControl property_control = 1;  // vuy
        CarActionControl action_control = 2;       // vwi
        CarControlGroup control_group = 3;         // vwm (recursive)
    }
    optional bool enabled = 4;
    repeated CarControlMetadataType metadata = 5 [packed = true];
    optional SideAffinity side_affinity = 6;
}

// APK class: vwm → SafeParcelable: CarControlGroup
message CarControlGroup {
    optional CarControlGroupType group_type = 1;
    repeated CarControl controls = 2;
}

// ============================================================================
// Top-level messages (received by handler)
// ============================================================================

// 0x8002: SetCarPropertyValueResponse (APK class: wcb)
// Phone responds to HU's set-property request with result.
message SetCarPropertyValueResponse {
    optional CarProperty car_property = 1;
    optional CarControlStatus status = 2;
    optional string request_id = 3;     // UUID correlating to original request
    optional int32 error_code = 4;      // CarPropertySetError.error
}

// 0x8004: RegisterCarPropertyListenersResponse (APK class: wbk)
// Phone responds with current values for all registered properties.
message RegisterCarPropertyListenersResponse {
    repeated SetCarPropertyListenerResult results = 1;
}

// APK class: vwv — individual listener registration result
message SetCarPropertyListenerResult {
    optional CarProperty car_property = 1;
    optional CarControlStatus status = 2;
}

// 0x8005: CarPropertyChangeEvent (APK class: vwu)
// Phone notifies HU that a car property value changed.
message CarPropertyChangeEvent {
    optional CarProperty car_property = 1;
    optional CarPropertyValue property_value = 2;
    optional int32 status = 3;
}

// 0x8007: CarControlGroupUpdate (APK class: vwn)
// Phone sends updated control group layout to HU.
message CarControlGroupUpdate {
    optional CarControlGroup car_control_group = 1;
}

// NOTE: Messages 0x8001 (SetCarPropertyValueRequest) and 0x8003
// (RegisterCarPropertyListenersRequest) are HU→Phone. Their proto
// structures are TBD — the handler only receives, not sends, so the
// request protos aren't deserialized in hxp.java.
