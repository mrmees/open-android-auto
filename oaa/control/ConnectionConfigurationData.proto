// Android Auto Protocol Buffer Definitions
// https://github.com/mrmees/open-android-auto
// SPDX-License-Identifier: GPL-3.0-or-later

/*
 * ConnectionConfiguration — connection setup parameters.
 *
 * APK class: aajk.java (AA v16.1)
 * Embedded in ServiceDiscoveryResponse field 16.
 * Fields 2-6 form a oneof (previously decoded as flat fields at 1/2/4/60).
 *
 * NOTE: Sub-messages of ConnectionTransportConfig (aajt, aakd) and
 * ConnectionTuningConfig's oneof members (aajf, aajb, aajd, aajc) have
 * not been fully decoded — kept as bytes until we have live captures.
 */

syntax="proto3";

import "oaa/common/PingConfigurationData.proto";

package oaa.proto.data;

message ConnectionConfiguration {
    optional PingConfiguration ping_configuration = 1;  // APK: zyd

    oneof config_type {
        ConnectionSecurityConfig security_config = 2;   // APK: aajj
        ConnectionTransportConfig transport_config = 3;  // APK: aajh
        ConnectionFeatureFlags feature_flags = 4;        // APK: aaja
        ConnectionTuningConfig tuning_config = 5;        // APK: aajg
        ConnectionReservedConfig reserved_config = 6;    // APK: aaji (empty)
    }
}

// Connection security mode for the AA protocol link (APK class: aajj)
// Distinct from WiFi security — this controls the AA session encryption.
// Values mapped through a.bC() in the APK.
enum ConnectionSecurityMode {
    CONNECTION_SECURITY_UNKNOWN = 0;
    CONNECTION_SECURITY_ENCRYPTED = 1;
}

// APK class: aajj — 1 enum field
message ConnectionSecurityConfig {
    optional ConnectionSecurityMode security_mode = 1;
}

// APK class: aajh — 2 sub-message fields (fields 2-3, no field 1)
message ConnectionTransportConfig {
    optional TransportMetadata transport_metadata = 2;        // APK: aajt
    optional TransportSecurityConfig transport_security = 3;  // APK: aakd
}

// APK class: aaja — single bool
message ConnectionFeatureFlags {
    optional bool enabled = 1;
}

// APK class: aajg — uint32 + oneof with 4 sub-messages
message ConnectionTuningConfig {
    optional uint32 timeout_ms = 1;

    oneof tuning_params {
        TuningParamsA tuning_a = 2;    // APK: aajf — sub-message, fields TBD
        TuningParamsB tuning_b = 3;    // APK: aajb — sub-message, fields TBD
        TuningParamsC tuning_c = 4;    // APK: aajd — sub-message, fields TBD
        TuningParamsD tuning_d = 5;    // APK: aajc — sub-message, fields TBD
    }

    // Note: timeout_factor at field 60 was previously here, but APK descriptor
    // only shows 5 fields (1 + oneof 2-5). High field numbers may not be encoded
    // in proto-lite descriptors. Removed to match APK exactly.
}

// APK class: aaji — empty message
message ConnectionReservedConfig {
}

// APK class: aajt (proto3) — transport metadata
// Sub-message ref: aajs (TransportCapabilities)
message TransportMetadata {
    optional TransportCapabilities capabilities = 1;  // APK: message (aajs)
    string transport_name = 2;                        // APK: string
}

// APK class: aajs (proto3) — transport capability details
message TransportCapabilities {
    repeated TransportCapabilityEntry entries = 1;   // APK: repeated message
    repeated string supported_protocols = 2;         // APK: repeated string
}

// Placeholder for TransportCapabilities sub-message entries
message TransportCapabilityEntry {}

// APK class: aakd (proto3) — transport security configuration
// Sub-message ref: aakc (TransportSecurityEntry) at field 2
message TransportSecurityConfig {
    optional TransportSecurityEntry security_entry = 1;  // APK: message (aakc) at field 1
}

// APK class: aakc (proto3) — security entry
// Sub-message ref: aakb
message TransportSecurityEntry {
    optional TransportSecurityDetail detail = 2;  // APK: message (aakb) at field 2
}

// APK class: aakb — placeholder for security detail structure
message TransportSecurityDetail {}

// APK class: aajf — sub-message of ConnectionTuningConfig oneof
// Placeholder — sub-message structure TBD from wire captures
message TuningParamsA {
}

// APK class: aajb — sub-message of ConnectionTuningConfig oneof
// Placeholder — sub-message structure TBD from wire captures
message TuningParamsB {
}

// APK class: aajd — sub-message of ConnectionTuningConfig oneof
// Placeholder — sub-message structure TBD from wire captures
message TuningParamsC {
}

// APK class: aajc — sub-message of ConnectionTuningConfig oneof
// Placeholder — sub-message structure TBD from wire captures
message TuningParamsD {
}
