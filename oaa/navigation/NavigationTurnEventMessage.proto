// Android Auto Protocol Buffer Definitions
// https://github.com/mrmees/open-android-auto
// SPDX-License-Identifier: GPL-3.0-or-later

/*
 * NavigationTurnEvent — turn-by-turn navigation detail.
 *
 * APK class: vzm.java (AA v16.1)
 * Channel: Navigation (channel 10)
 * Message ID: 0x8004 (32772) — sent by phone
 * Dispatched by hkx.java line 1033: hzyVar.k(32772, o.q())
 *
 * Contains turn icon, maneuver type, turn side, and distance.
 * Complements NavigationStep (0x8003) with richer turn detail.
 *
 * VERIFIED active via DHU 2.1 + logcat (2026-02-28):
 * Phone-side class: com.google.android.apps.auto.sdk.nav.state.TurnEvent
 * Fires at ~1Hz during active navigation (Google Maps).
 * Phone logs: CSL.AbstractBundleable: Failed to instantiate TurnEvent
 *   BadParcelableException on obfuscated class "lbg" — version mismatch
 *   between DHU's car app library and phone's AA app, not a proto issue.
 */

syntax = "proto2";

import "oaa/navigation/ManeuverTypeEnum.proto";
import "oaa/navigation/TurnSideEnum.proto";
import "oaa/navigation/NavigationDistanceDisplayData.proto";

package oaa.proto.messages;

message NavigationTurnEvent {
    optional string road_name = 1;                   // APK: b — descriptor says string (not bytes)
    optional oaa.proto.enums.ManeuverType.Enum maneuver_type = 2;   // APK: c — descriptor says enum (int32 wire)
    optional oaa.proto.enums.TurnSide.Enum turn_direction = 3;      // APK: d (int, default=1) — validated by vyv.h/vee.Q()
    optional bytes turn_icon = 4;                    // APK: e — descriptor says bytes
    optional int32 distance_meters = 5;              // APK: f (int) — distance to turn
    optional int32 distance_unit = 6;                // APK: g (int) — distance display unit
}

// APK class: vzg — turn distance with display text and unit
// Distinct from NavigationDistance (xnb) which is the full distance/ETA message.
message NavigationTurnDistance {
    optional int32 distance_value = 1;    // APK: int32
    optional string display_text = 2;     // APK: string
    optional int32 distance_unit = 3;     // APK: enum (int32 wire) — distance unit type
}

// APK class: vzf — destination distance with remaining time
// Sub-message ref: vzg (NavigationTurnDistance)
message DestinationDistance {
    optional NavigationTurnDistance distance = 1;   // APK: message (vzg)
    optional string destination_name = 2;           // APK: string
    optional int64 eta_timestamp = 3;               // APK: int64
}

// APK class: vzv — remaining distance to destination
// Sub-message ref: vzg (NavigationTurnDistance)
message NavigationRemainingDistance {
    optional NavigationTurnDistance distance = 1;   // APK: message (vzg)
    optional int64 remaining_meters = 2;           // APK: int64
}

// APK class: vzn — simple string wrapper used in turn distance event
message NavigationTurnLabel {
    optional string label = 1;   // APK: string
}

// APK class: vzd — next turn distance event with remaining and step distances
// Sub-message refs: vzv (NavigationRemainingDistance), vzn (NavigationTurnLabel)
message NavigationNextTurnDistanceEvent {
    optional NavigationRemainingDistance remaining_distance = 1;  // APK: message (vzv)
    repeated NavigationTurnLabel turn_labels = 2;                // APK: repeated message (vzn)
    optional NavigationStepDistance step_distance = 3;            // APK: message — forward ref
}

// APK class: xmv — step distance with raw distance value
// Sub-message ref: xmw (NavigationDistanceValue, in NavigationDistanceDisplayData.proto)
message NavigationStepDistance {
    optional data.NavigationDistanceValue distance_value = 1;  // APK: message (xmw)
    optional int64 distance_meters = 2;                        // APK: int64
}
